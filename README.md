<h1>Antispam Helper</h1>

Антиспам помощник для почтового сервера Communigate Pro, в котором из коробки крайне слабые возможности по фильтрации спама. 
С помощью данного помощника можно блокировать отправителей по адресам, доменам (для доменов поддерживается символ подстановки *).
Также помощник раскодирует тело письма (обычно закодированное с использованием MIME или UU кодировки) - можно использовать фильтры по ключевым словам/строкам или регулярные выражения. 

<h2>Установка</h2>

Скачайте архив из релиза, разархивируйте.
Скопируйте папку CommunigateAntispamHelper в директорию данных CommuniGate Pro. Если необходимо, добавьте в манифест дочерних процессов (описание есть в документации сервера).

Измените пути в appsettings.json:
- baseDir - полный путь директории данных CommuniGate Pro.
- currentDir - полный путь к запускаемому файлу помощника.

Остальные файлы создадутся автоматически при первом старте помощника.
В интерфейсе администратора Communigate Pro перейдите "Установки-Общее-Помощники" и добавьте помощник. Путь к программе: "CommunigateAntispamHelper/CommunigateAntispamHelper", имя "AntispamHelper". Включите помощник.

Перейдите "Установка-Почта-Правила". Добавьте правило:
- Поле заголовка "не равно"  From: MAILER-DAEMON@*
- Источник "не среди" trusted,authenticated
- Любой маршрут "среди"  LOCAL(*,LIST(*
<br>Действие "Внешний фильтр"  AntispamHelper.

<h2> Настройка</h2>

Настройка осуществляется в файлах в каталоге помощника. Все данные заполняются построчно, одна строка - один элемент:

- excludedRecipients: email адреса реципиентов, для которых спам правила не применяются.
- whiteListSenderAddresses: белый список email адресов отправителей (для них не применяются фильтры тела письма).
- whiteListSenderDomains: белый список доменов отправителей (для них не применяются фильтры тела письма).
- blackListSenderAddresses: черный список адресов отправителей.
- blackListSenderDomains: черный список доменов отправителей.
- prohibitedTextInBody: строки, при нахождении которых в теле письма, письмо попадает в черный список.
- prohibitedRegExInBody: регулярные выражения, при нахождении которых в теле письма, письмо попадает в черный список. Применяются с флагами im.
- goodMessage: ответ помощника серверу на "нормальное" письмо. По умолчанию ОК. Используется запись только в первой строчке файла.
- badMessage: ответ помощника серверу на спам. По умолчанию ADDHEADER "X-SPAM-SCORE: 100 CommunigateAntispamHelper" OK. Используется запись только в первой строчке файла. Можно написать DISCARD в первой строчке файла - спам будет отбрасываться.
<p>Все изменения в файлах считываются автоматически, перезапускать помощник не требуется.








